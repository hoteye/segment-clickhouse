# 三环境基础设施建设指南

## 1. 总体架构概述

本方案采用开发、测试、生产三环境物理隔离架构，确保数据安全的同时支持高效的软件工程建设。

### 1.1 环境隔离模式
- **开发环境**：可访问互联网，用于代码开发、依赖下载、技术调研
- **测试环境**：内网隔离，通过离线介质从开发环境获取代码，可单向查询生产监控数据
- **生产环境**：完全隔离，只允许数据流入，禁止任何形式的数据外传

## 2. 开发环境基础设施

### 2.1 硬件配置要求

#### 2.1.1 开发工作站配置（按100人团队规模）
- **高配开发机**（架构师、核心开发者，20台）
  - CPU：Intel i9-12900K 或 AMD Ryzen 9 5900X
  - 内存：64GB DDR4 3200MHz
  - 存储：2TB NVMe SSD + 4TB HDD
  - 显卡：NVIDIA RTX 3060（支持AI辅助开发）
  - 显示器：双27寸4K显示器

- **标准开发机**（普通开发者，80台）
  - CPU：Intel i7-12700 或 AMD Ryzen 7 5700X
  - 内存：32GB DDR4
  - 存储：1TB NVMe SSD + 2TB HDD
  - 显示器：双24寸2K显示器

#### 2.1.2 服务器配置
- **代码仓库服务器**（2台，主备）
  - CPU：双路 Intel Xeon Gold 6248R（48核）
  - 内存：256GB ECC
  - 存储：8TB NVMe SSD（RAID 10）
  - 用途：GitLab 企业版部署

- **CI/CD 服务器**（4台）
  - CPU：双路 Intel Xeon Silver 4214R（24核）
  - 内存：128GB ECC
  - 存储：4TB NVMe SSD
  - 用途：Jenkins、构建任务、自动化测试

- **开发数据库服务器**（2台）
  - CPU：双路 Intel Xeon Gold 6248R
  - 内存：512GB ECC
  - 存储：16TB NVMe SSD（RAID 10）
  - 用途：MySQL、ClickHouse 开发实例

- **依赖管理服务器**（2台）
  - CPU：Intel Xeon Silver 4214R
  - 内存：64GB ECC
  - 存储：20TB HDD（RAID 6）
  - 用途：Maven 私服、Docker Registry、NPM 私服

#### 2.1.3 网络设备
- **核心交换机**：华为 S6730-H48X6C（48口万兆 + 6口100G上联）
- **接入交换机**：华为 S5731-48P4X（48口千兆 PoE + 4口万兆上联）×5台
- **防火墙**：华为 USG6650（支持 20Gbps 吞吐）
- **互联网带宽**：1000Mbps 商业专线（上下行对等）
- **内网带宽**：万兆到桌面，服务器 25Gbps 互联

### 2.2 软件配置清单

#### 2.2.1 开发工具
- **IDE 和编辑器**
  - Cursor（全员配置 Pro 版本）- AI 辅助编程主力工具
  - Claude Code（企业版授权）- AI 编程助手
  - IntelliJ IDEA Ultimate - Java 开发
  - Visual Studio Code - 前端开发
  - DataGrip - 数据库管理

- **版本控制**
  - GitLab 企业版 15.0+（本地部署）
  - Git 2.30+（支持 sparse-checkout）
  - GitLab Runner（分布式构建）

- **容器化工具**
  - Docker Desktop 企业版
  - Docker Compose 2.0+
  - Kubernetes 开发集群（3节点）

#### 2.2.2 依赖管理
- **Maven 私服（Nexus Repository Manager 3）**
  - 配置中央仓库代理
  - 配置阿里云镜像代理
  - 本地组件仓库
  - 定期同步策略：每日凌晨2点全量同步

- **Docker Registry（Harbor 2.5+）**
  - 镜像代理缓存
  - 镜像安全扫描
  - 镜像签名验证
  - 存储容量：10TB

- **NPM 私服（Verdaccio）**
  - npm 官方源代理
  - 私有包发布
  - 下载缓存

#### 2.2.3 开发支撑系统
- **API 文档管理**：Swagger UI + YApi
- **数据库设计**：PDManer（元数建模）
- **项目管理**：Jira + Confluence
- **代码质量**：SonarQube 9.0+ 社区版

### 2.3 开发环境网络架构

开发环境采用扁平化网络设计，确保开发效率：
- VLAN 10：开发工作站网段（10.1.1.0/24）
- VLAN 20：开发服务器网段（10.1.2.0/24）
- VLAN 30：CI/CD 网段（10.1.3.0/24）
- VLAN 100：互联网出口网段（10.1.100.0/24）

所有 VLAN 之间通过核心交换机三层转发，访问控制策略宽松，以开发效率为先。

## 3. 测试环境基础设施

### 3.1 硬件配置要求

#### 3.1.1 服务器配置（与生产环境 1:1 配比）
- **应用服务器**（8台）
  - CPU：双路 Intel Xeon Gold 6342（48核）
  - 内存：256GB ECC
  - 存储：2TB NVMe SSD（系统盘）
  - 网卡：双口 25Gbps

- **数据库服务器**（4台）
  - CPU：双路 Intel Xeon Gold 6342
  - 内存：512GB ECC
  - 存储：8TB NVMe SSD（RAID 10）
  - 用途：ClickHouse 集群、MySQL 主从

- **中间件服务器**（6台）
  - CPU：双路 Intel Xeon Silver 4314（32核）
  - 内存：128GB ECC
  - 存储：4TB NVMe SSD
  - 用途：Kafka 集群、Redis 集群、Flink 集群

- **负载均衡器**（2台）
  - 硬件 F5 或华为 ELB
  - 支持 4-7 层负载均衡
  - SSL 卸载能力

#### 3.1.2 网络设备
- **核心交换机**：华为 S6730-H24X6C（24口万兆 + 6口100G）×2台（堆叠）
- **接入交换机**：华为 S5731-48X4C（48口万兆）×4台
- **防火墙**：华为 USG6650（测试与生产边界）
- **单向网闸**：安恒信息单向导入系统（测试→生产查询）

#### 3.1.3 存储设备
- **离线介质管理**
  - 加密 U 盘（64GB）×20个
  - 蓝光刻录机 + 光盘（用于归档）
  - 介质保险柜（指纹+密码）

### 3.2 软件配置清单

#### 3.2.1 基础软件环境
- **操作系统**：CentOS 7.9 / Rocky Linux 8.6（统一版本）
- **容器平台**：Kubernetes 1.24（生产级配置）
- **监控系统**：Prometheus + Grafana（独立部署）

#### 3.2.2 离线依赖仓库（重要）
- **Maven 本地仓库**
  - 完整的 Maven Central 镜像（约 15TB）
  - 企业内部组件库
  - 更新方式：每月从开发环境全量同步一次
  - 存储路径：/data/maven-repository

- **Docker 镜像仓库**
  - Harbor 2.5+（与开发环境版本一致）
  - 基础镜像：OS、JDK、Python、Node.js 等
  - 中间件镜像：MySQL、Redis、Kafka、ClickHouse
  - 应用镜像：通过离线介质导入

- **系统包仓库**
  - CentOS/Rocky Linux 完整 YUM 源
  - EPEL 源镜像
  - 更新方式：季度更新

#### 3.2.3 测试工具
- **性能测试**
  - JMeter 5.5（分布式部署）
  - Gatling 3.8
  - ClickHouse 性能测试工具

- **自动化测试**
  - Selenium Grid（UI 自动化）
  - TestNG + RestAssured（接口测试）
  - Cucumber（BDD 测试）

- **安全测试**
  - OWASP ZAP（Web 安全扫描）
  - Dependency Check（依赖漏洞扫描）
  - SonarQube（代码安全审计）

### 3.3 测试环境特殊配置

#### 3.3.1 离线开发工具
由于测试环境无法联网，需要预装以下离线工具：
- 离线版 VS Code + 常用插件包
- 离线 Maven 插件
- 离线文档服务器（包含所有技术栈文档）
- 问题排查工具集（tcpdump、strace、arthas 等）

#### 3.3.2 数据管理
- **测试数据生成器**：基于生产数据结构的mock数据生成
- **生产数据查询代理**：通过单向网闸查询生产监控指标
- **数据脱敏工具**：如需导入生产数据样本时使用

## 4. 生产环境基础设施

### 4.1 硬件配置要求（高可用设计）

#### 4.1.1 服务器配置
- **应用服务器**（16台，双活数据中心各8台）
  - 配置与测试环境相同
  - 增加 BMC 远程管理卡
  - 双电源冗余

- **数据库服务器**（8台）
  - 配置与测试环境相同，内存升级至 1TB
  - 企业级 SSD，带掉电保护
  - 专用存储网络（SAN）

- **容灾备份服务器**（4台）
  - 磁带库：支持 LTO-8（12TB/盒）
  - 备份软件：Veritas NetBackup

#### 4.1.2 网络安全设备
- **防火墙集群**：CheckPoint 26000 系列
- **入侵检测**：绿盟 IDS
- **堡垒机**：齐治堡垒机（支持 4A 认证）
- **日志审计**：启明星辰日志审计系统

### 4.2 软件配置（略）
生产环境软件配置与测试环境基本一致，主要差异：
- 启用所有安全加固选项
- 关闭所有调试接口
- 配置实时备份策略
- 启用全量审计日志

## 5. 环境间数据传输机制

### 5.1 开发到测试（离线传输）
**传输流程**：
1. 开发环境打包（代码、镜像、依赖）
2. 生成 SHA256 校验文件
3. AES-256 加密
4. 写入加密 U 盘
5. 物理转移到测试环境
6. 测试环境导入验证

**传输频率**：
- 日常版本：每日一次
- 紧急修复：按需传输
- 依赖更新：每月一次

### 5.2 测试到生产（版本发布）
**版本管理系统**：
- 独立的版本发布平台（部署在生产网段）
- 支持版本包上传、审批、发布流程
- 版本回滚机制
- 发布窗口管理

**发布流程**：
1. 测试环境完成测试，生成版本包
2. 通过单向网闸将版本包推送到生产环境的版本仓库
3. 运维人员在生产环境通过版本管理系统执行发布
4. 自动化部署脚本完成应用更新
5. 发布完成后自动进行健康检查

**安全控制**：
- 版本包签名验证
- 发布审批流程（至少两人审批）
- 发布操作审计日志
- 自动化回滚机制

## 6. 团队效能工具配置

### 6.1 开发效能提升
- **AI 编程助手**：Cursor + Claude Code 大幅提升编码效率
- **代码模板**：基于项目的代码生成器
- **自动化脚本**：环境初始化、部署自动化
- **知识库**：Confluence + 技术博客

### 6.2 协作工具
- **即时通讯**：企业微信/钉钉（开发环境）
- **视频会议**：腾讯会议企业版（开发环境）
- **任务管理**：Jira 本地部署版
- **文档协作**：Confluence + draw.io
- **版本管理系统**：自研或采用 Spinnaker/ArgoCD（生产环境部署）

## 7. 容量规划建议

基于 100 人开发团队，系统预期处理能力：
- 代码仓库：支持 1000+ 项目，100TB 存储
- CI/CD：日构建 2000+ 次，并发 20 个任务
- 测试环境：支持 50 个并发性能测试
- 监控数据：保留 90 天详细数据，1 年汇总数据

## 8. 投资预算估算

### 8.1 硬件投资（一次性）
- 开发环境：约 800 万元
- 测试环境：约 1200 万元
- 生产环境：约 2000 万元
- 网络安全设备：约 500 万元
- **合计**：约 4500 万元

### 8.2 软件授权（年费）
- 开发工具授权：约 200 万元/年
- 企业软件授权：约 300 万元/年
- AI 工具订阅：约 100 万元/年
- **合计**：约 600 万元/年

### 8.3 运维成本（年度）
- 带宽费用：约 120 万元/年
- 电力成本：约 200 万元/年
- 运维人员：约 400 万元/年（10人团队）
- **合计**：约 720 万元/年

通过以上基础设施建设，可确保开发效率、测试充分性和生产安全性的平衡，支撑高质量的软件工程建设。